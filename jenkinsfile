pipeline {
    agent any
    // environment {
    //     MAVEN_HOME = 'C:/Users/victor/apache-maven-3.9.4-bin/apache-maven-3.9.4/bin/mvn'
    // }
    tools { 
      maven 'MAVEN_HOME' 
      jdk 'JAVA_HOME' 
      aws 'AWS_HOME'
    }
    stages {
        stage('Start') {
            steps {
                echo 'Iniciando a pipeline.'
            }
        }
        stage('Test') {
            steps {
                script {
                    dir("${WORKSPACE}/schneiderstream") {
                        bat 'mvn test'
                    }
                }
            }
        }
        stage('Build') {
            steps {
                script {
                    dir("${WORKSPACE}/schneiderstream") {
                        bat 'mvn clean install'
                    }
                }
            }
        }
        stage('Upload') {
            steps {
                withAWS(credentials: $AWS_USERID, region: 'us-east-2') {
                    bat 'aws s3 cp "target/schneiderstream-0.0.1-SNAPSHOT.jar" s3://schneiderstreambucket/schneiderstream-0.0.1-SNAPSHOT.jar'
                }
            }
        }
    }
}
